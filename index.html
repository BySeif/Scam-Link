<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>For Alya ğŸ’Œ</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --pink1:#ffb6d9; --pink2:#ffd6eb; --accent:#ff2e88; --btn1:#ff4d9e; --soft:#fff6fc;
    }
    html,body{height:100%;margin:0;}
    body{
      font-family:"Poppins",system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      background:linear-gradient(160deg,var(--pink1),var(--pink2));
      display:flex;align-items:center;justify-content:center;padding:18px;color:#222;
    }
    .card { width:100%; max-width:720px; text-align:center; }
    #startScreen { display:flex; flex-direction:column; align-items:center; gap:20px; padding:24px 0; }
    #envelope { width:260px; max-width:86vw; cursor:pointer; transition:transform .35s ease, filter .35s; filter:drop-shadow(0 12px 26px rgba(0,0,0,0.18)); border-radius:18px; }
    #envelope:hover { transform:translateY(-6px) rotate(-2deg) scale(1.02); }
    .title { margin:0; font-family:"Playfair Display",serif; color:var(--accent); font-size:clamp(26px,4.4vw,44px); }
    .openBtn { background:linear-gradient(90deg,var(--btn1),#ff6fb0); color:white; border:none; padding:14px 36px; border-radius:36px; font-size:18px; box-shadow:0 10px 26px rgba(255,77,158,0.25); cursor:pointer; }
    .pulse { animation:pulse 1.6s infinite; }
    @keyframes pulse {0%{transform:scale(1);}50%{transform:scale(1.07);}100%{transform:scale(1);}}
    /* ... other CSS unchanged (omitted for brevity) ... */
    .hidden{display:none!important;}
  </style>
</head>
<body>
  <div class="card" id="card">
    <div id="startScreen">
      <!-- NOTE: make sure the file names on disk match these exactly (case-sensitive on some servers) -->
      <img id="envelope" src="envelope.png" alt="Envelope for Alya" />
      <h1 class="title">For Alya ğŸ’—ğŸ’Œ</h1>
      <button class="openBtn pulse" id="openBtn">Open</button>
    </div>
  </div>

<script>
/* Defensive globals */
window._heartsInterval = null;
window._confettiInterval = null;

/* Attach event listeners after DOM ready */
document.addEventListener('DOMContentLoaded', () => {
  const env = document.getElementById('envelope');
  const openBtn = document.getElementById('openBtn');

  if(env) env.addEventListener('click', openLetter);
  if(openBtn) openBtn.addEventListener('click', openLetter);

  console.log('Handlers attached (DOMContentLoaded).');
});

/* Open letter â€” same logic but we attach handlers dynamically for new buttons */
function openLetter(){
  const card = document.getElementById('card');
  const env = document.getElementById('envelope');
  if(env) env.style.transform = 'scale(.98)';

  card.innerHTML = `
    <div id="questionWrap">
      <img id="mainPhoto" src="mainphoto.jpg" alt="Alya" style="width:86vw;max-width:420px;border-radius:18px;box-shadow:0 14px 34px rgba(0,0,0,0.18);height:auto;object-fit:cover;">
      <h2 style="margin:0; font-family:'Playfair Display', serif; color:#ffffff; text-shadow:0 4px 18px rgba(0,0,0,0.22); font-size:clamp(20px,5vw,32px);">
        Will you be my Valentine? ğŸ’–
      </h2>

      <div class="btnRow" style="margin-top:14px;">
        <button class="yes" id="yesBtn">Yes ğŸ’•</button>
        <button class="no" id="noBtn">No ğŸ˜¢</button>
      </div>
    </div>
  `;

  // re-attach listeners to the newly inserted buttons
  const yes = document.getElementById('yesBtn');
  const no = document.getElementById('noBtn');

  if(yes) yes.addEventListener('click', showFinal);
  if(no) no.addEventListener('click', function(){ noClicked(this); });

  // reset transform after a moment
  if(env) setTimeout(()=>{ if(env) env.style.transform=''; },300);

  console.log('openLetter executed, question screen injected.');
}

/* No button behavior */
let _noIndex = 0;
let _yesScale = 1;
const noMsgs = [
  "Are you sure? ğŸ¥º","Really sure??","Alyaâ€¦ that's kinda cold ğŸ˜”",
  "Think again...","You sure about that?","Okay now you're just testing me","You dont love me"
];

function noClicked(el){
  if(_noIndex < noMsgs.length){ el.textContent = noMsgs[_noIndex++]; }
  else el.textContent = "Still no? ğŸ˜­";

  _yesScale += 0.30;
  const yes = document.getElementById('yesBtn');
  if(yes){
    yes.style.transform = 'scale(' + _yesScale + ')';
    yes.style.transition = 'transform .22s ease';
  }

  el.style.position = 'absolute';
  const left = Math.min(84, 6 + Math.random() * 78);
  const top  = Math.min(78, 8 + Math.random() * 68);
  el.style.left = left + '%';
  el.style.top  = top  + '%';
  el.style.zIndex = 9999;
}

/* Final screen */
function showFinal(){
  const card = document.getElementById('card');
  if(window._heartsInterval){ clearInterval(window._heartsInterval); window._heartsInterval = null; }
  if(window._confettiInterval){ clearInterval(window._confettiInterval); window._confettiInterval = null; }

  card.innerHTML = `
    <div id="finalWrap">
      <div id="finalText">You had no choice ğŸ˜ŒğŸ’•<br><br>Guess we have plans now.ğŸ˜</div>
      <img id="finalPhoto" src="finalphoto.jpg" alt="Us" style="width:90vw;max-width:560px;max-height:58vh;object-fit:cover;border-radius:18px;box-shadow:0 18px 40px rgba(0,0,0,0.22);">
    </div>
  `;

  startHeartsContinuous();
  startConfettiContinuous();
}

/* Hearts & Confetti (unchanged) */
function startHeartsContinuous(){
  if(window._heartsInterval) clearInterval(window._heartsInterval);
  window._heartsInterval = setInterval(()=>{
    const heart = document.createElement('div');
    heart.className = 'floating-heart';
    heart.innerHTML = 'ğŸ’–';
    heart.style.left = Math.random() * 100 + 'vw';
    const size = 18 + Math.random() * 26;
    heart.style.fontSize = size + 'px';
    const dur = 3500 + Math.random() * 1800;
    heart.style.animationDuration = dur + 'ms';
    document.body.appendChild(heart);
    setTimeout(()=> heart.remove(), dur + 200);
  }, 420);
}

function startConfettiContinuous(){
  if(window._confettiInterval) clearInterval(window._confettiInterval);
  const colors = ['#ff2e88','#ffffff','#ffb6d9','#ff66b3','#ffd6eb','#ff4d9e'];
  window._confettiInterval = setInterval(()=>{
    const piece = document.createElement('div');
    piece.className = 'confetti-piece';
    piece.style.left = Math.random() * 100 + 'vw';
    piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    const w = 6 + Math.random() * 10;
    const h = 8 + Math.random() * 16;
    piece.style.width = w + 'px';
    piece.style.height = h + 'px';
    const dur = 2800 + Math.random() * 2200;
    piece.style.animationDuration = dur + 'ms';
    document.body.appendChild(piece);
    setTimeout(()=> piece.remove(), dur + 200);
  }, 140);
}

window.addEventListener('beforeunload', ()=>{
  if(window._heartsInterval) clearInterval(window._heartsInterval);
  if(window._confettiInterval) clearInterval(window._confettiInterval);
});
</script>
</body>
</html>